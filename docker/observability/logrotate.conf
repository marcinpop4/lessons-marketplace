# Logrotate configuration for lessons-marketplace logs
# This configuration uses the 'copytruncate' strategy which is compatible
# with log shipping tools like Promtail that keep file descriptors open.

# Application log files - unified configuration for all log types
/var/log/app/*.log {
    # Rotate daily
    daily
    # Keep 30 days of logs
    rotate 30
    # Compress old logs
    compress
    # Don't compress the first rotated file
    delaycompress
    # Don't fail if log file is missing
    missingok
    # Don't rotate empty files
    notifempty
    # Create new log files with specified permissions
    create 644 root root
    # Use date as suffix for rotated files
    dateext
    # Use YYYY-MM-DD format for date extension
    dateformat -%Y-%m-%d
    # Copy and truncate original file instead of moving it
    copytruncate
    # Run postrotate script for all files in the group
    sharedscripts
    # Commands to run after rotation
    postrotate
        # Send HUP signal to application if it has a PID file
        # This allows the application to reopen log files
        if [ -f /var/log/app/app.pid ]; then
            kill -HUP $(cat /var/log/app/app.pid) 2>/dev/null || true
        fi
    endscript
} 